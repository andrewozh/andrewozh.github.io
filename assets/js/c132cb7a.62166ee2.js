"use strict";(self.webpackChunkdevops_sandbox=self.webpackChunkdevops_sandbox||[]).push([[8095],{4602:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"observability/logs/elastic-operator","title":"Elastic Cloud on Kubernetes","description":"|Distro|ECK Operator|","source":"@site/docs/observability/logs/elastic-operator.md","sourceDirName":"observability/logs","slug":"/observability/logs/elastic-operator","permalink":"/docs/observability/logs/elastic-operator","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Manage ECK ElasticSearch users as Kubernetes resources","permalink":"/docs/observability/logs/elastic-auth-management"},"next":{"title":"ElasticSearch","permalink":"/docs/observability/logs/elastic"}}');var t=s(4848),i=s(8453);const a={},l="Elastic Cloud on Kubernetes",c={},o=[{value:"Setup",id:"setup",level:2},{value:"Usecases",id:"usecases",level:2},{value:"\u2705 Basic: create user for fluentbit, configure log shipping, view logs in Kibana",id:"white_check_mark-basic-create-user-for-fluentbit-configure-log-shipping-view-logs-in-kibana",level:3},{value:"Common: write data, read data, replication, etc.",id:"common-write-data-read-data-replication-etc",level:3},{value:"\u2705 Monitoring",id:"white_check_mark-monitoring",level:2},{value:"\ud83d\udd04 Operator metrics",id:"arrows_counterclockwise-operator-metrics",level:3},{value:"\u2705 Elasticsearch",id:"white_check_mark-elasticsearch",level:3},{value:"Maintenence",id:"maintenence",level:2},{value:"Articles",id:"articles",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"elastic-cloud-on-kubernetes",children:"Elastic Cloud on Kubernetes"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Distro"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.a,{href:"https://github.com/elastic/cloud-on-k8s",children:"ECK Operator"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Type"})}),(0,t.jsx)(n.td,{children:"kubernetes-operator"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Deploy"})}),(0,t.jsx)(n.td,{children:"helm-chart"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Docs"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s",children:"link"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Backup"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Scaling"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"CLI"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"UI"})}),(0,t.jsx)(n.td,{children:"kibana"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"deployment explained"}),"\n",(0,t.jsx)(n.li,{children:"how to setup"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s/manage-deployments",children:"https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s/manage-deployments"})}),"\n",(0,t.jsx)(n.h2,{id:"usecases",children:"Usecases"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"/docs/observability/logs/elastic-auth-management",children:"Use external-secret for managing users and role"})}),"\n",(0,t.jsxs)(n.h3,{id:"white_check_mark-basic-create-user-for-fluentbit-configure-log-shipping-view-logs-in-kibana",children:["\u2705"," Basic: create user for fluentbit, configure log shipping, view logs in Kibana"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"/docs/observability/logs/fluentbit#basic-send-kubernetes-pods-logs-to-elasticsearch",children:"Setup Fluent-bit for log shipping"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"/docs/observability/logs/kibana#basic-discover-all-logs",children:"View logs in Kibana"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["create secret ",(0,t.jsx)(n.code,{children:"role"})," for fluentbit"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Secret\nmetadata:\n  name: fluentbit-role\nstringData:\n  roles.yml: |\n    fluentbit:\n      cluster:\n        - monitor\n        - manage_index_templates\n        - manage_ilm\n      indices:\n        - names:\n            - "logstash-*"\n            - "node-*"\n            - "logs-*"\n            - "fluentbit-*"\n          privileges:\n            - create_index\n            - create\n            - index\n            - write\n            - manage\n            - manage_ilm\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["create secret ",(0,t.jsx)(n.code,{children:"user"})," for fluentbit"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Secret\nmetadata:\n  name: fluentbit-user-secret\n  namespace: logging\ntype: kubernetes.io/basic-auth\ndata:\n  username: $(echo -n "fluentbit" | base64)\n  password: $(echo -n "fluentbit" | base64)\n  roles: $(echo -n "fluentbit" | base64)\nEOF\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"apply new user and role"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"eck-stack:\n  eck-elasticsearch:\n    auth:\n      fileRealm:\n        - secretName: fluentbit-user-secret\n      roles:\n        - secretName: fluentbit-role\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"try new user"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'root@dev-sandbox:/# curl -k -u fluentbit:fluentbit https://elasticsearch-es-internal-http.logging.svc.cluster.local:9200/_cluster/health\n{"cluster_name":"elasticsearch","status":"green","timed_out":false,"number_of_nodes":1,"number_of_data_nodes":1,"active_primary_shards":35,"active_shards":35,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":0,"unassigned_primary_shards":0,"delayed_unassigned_shards":0,"number_of_pending_tasks":0,"number_of_in_flight_fetch":0,"task_max_waiting_in_queue_millis":0,"active_shards_percent_as_number":100.0}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"common-write-data-read-data-replication-etc",children:"Common: write data, read data, replication, etc."}),"\n",(0,t.jsxs)(n.h2,{id:"white_check_mark-monitoring",children:["\u2705"," Monitoring"]}),"\n",(0,t.jsxs)(n.h3,{id:"arrows_counterclockwise-operator-metrics",children:["\ud83d\udd04"," Operator metrics"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://www.elastic.co/docs/deploy-manage/monitor/orchestrators/k8s-enabling-metrics-endpoint",children:"https://www.elastic.co/docs/deploy-manage/monitor/orchestrators/k8s-enabling-metrics-endpoint"})}),"\n",(0,t.jsxs)(n.h3,{id:"white_check_mark-elasticsearch",children:["\u2705"," Elasticsearch"]}),"\n",(0,t.jsx)(n.admonition,{title:"Grafana Dashboard",type:"note",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/2322-elasticsearch/",children:"https://grafana.com/grafana/dashboards/2322-elasticsearch/"})})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["deploy ",(0,t.jsx)(n.code,{children:"prometheus-elasticsearch-exporter"})," and configure es endpoint"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"prometheus-elasticsearch-exporter:\n  es:\n    uri: https://fluentbit:fluentbit@elasticsearch-es-http.logging.svc:9200\n    sslSkipVerify: true\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"check metrics"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl elk-prometheus-elasticsearch-exporter.logging:9108/metrics\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"create service monitor"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'prometheus-elasticsearch-exporter:\n  serviceMonitor:\n    enabled: true\n    namespace: "monitoring"\n    jobLabel: "app.kubernetes.io/name"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"maintenence",children:"Maintenence"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Backup / Restore"}),"\n",(0,t.jsx)(n.li,{children:"Scaling"}),"\n",(0,t.jsx)(n.li,{children:"Upgrade"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"articles",children:"Articles"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#",children:"Example article link"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var r=s(6540);const t={},i=r.createContext(t);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);