"use strict";(self.webpackChunkdevops_sandbox=self.webpackChunkdevops_sandbox||[]).push([[2152],{157:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/external-secrets-shared-cluster-secret-store-49e354bca1df1a671e34efa51cc9698d.png"},4922:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"security/secrets/external-secrets","title":"external-secrets","description":"|Distro|external-secrets|","source":"@site/docs/security/secrets/external-secrets.md","sourceDirName":"security/secrets","slug":"/security/secrets/external-secrets","permalink":"/docs/security/secrets/external-secrets","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"distro","permalink":"/docs/tags/distro"},{"inline":true,"label":"tool","permalink":"/docs/tags/tool"},{"inline":true,"label":"external-secrets","permalink":"/docs/tags/external-secrets"},{"inline":true,"label":"secrets","permalink":"/docs/tags/secrets"},{"inline":true,"label":"security","permalink":"/docs/tags/security"}],"version":"current","frontMatter":{"tags":["distro","tool","external-secrets","secrets","security"]},"sidebar":"tutorialSidebar","previous":{"title":"Secrets Management","permalink":"/docs/security/secrets/"},"next":{"title":"Vault","permalink":"/docs/security/secrets/vault"}}');var n=s(4848),c=s(8453);const a={tags:["distro","tool","external-secrets","secrets","security"]},i="external-secrets",l={},o=[{value:"Architecture",id:"architecture",level:2},{value:"\u2705 Setup",id:"white_check_mark-setup",level:2},{value:"\u2705 Hashicorp Vault",id:"white_check_mark-hashicorp-vault",level:3},{value:"Usecases",id:"usecases",level:2},{value:"\u2705 Basic: get secret, add secret from secret store",id:"white_check_mark-basic-get-secret-add-secret-from-secret-store",level:3},{value:"Common: generate secrets, update secrets, rotate secrets",id:"common-generate-secrets-update-secrets-rotate-secrets",level:3},{value:"\u2705 Monitoring",id:"white_check_mark-monitoring",level:2},{value:"Maintenence",id:"maintenence",level:2},{value:"Articles",id:"articles",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"external-secrets",children:"external-secrets"})}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:(0,n.jsx)(t.strong,{children:"Distro"})}),(0,n.jsx)(t.th,{children:(0,n.jsx)(t.a,{href:"https://external-secrets.io",children:"external-secrets"})})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Type"})}),(0,n.jsx)(t.td,{children:"kubernetes-operator"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Deploy"})}),(0,n.jsx)(t.td,{children:"helm-chart"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Docs"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"https://external-secrets.io/latest/",children:"link"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Backup"})}),(0,n.jsx)(t.td,{})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"Scaling"})}),(0,n.jsx)(t.td,{})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"CLI"})}),(0,n.jsx)(t.td,{})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"UI"})}),(0,n.jsx)(t.td,{})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"architecture",children:"Architecture"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://external-secrets.io/v0.8.1/guides/multi-tenancy/",children:"Source"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Shared ClusterSecretStore:"}),"\n",(0,n.jsx)(t.img,{alt:"Shared ClusterSecretStore diagram",src:s(157).A+"",width:"1150",height:"756"})]}),"\n",(0,n.jsxs)(t.h2,{id:"white_check_mark-setup",children:["\u2705"," Setup"]}),"\n",(0,n.jsxs)(t.h3,{id:"white_check_mark-hashicorp-vault",children:["\u2705"," Hashicorp Vault"]}),"\n",(0,n.jsxs)(t.p,{children:["See ",(0,n.jsx)(t.a,{href:"/docs/security/secrets/vault",children:"Vault"})," docs for more details."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Create a Vault engine path:\n",(0,n.jsx)(t.code,{children:"Secret Engines"})," -> ",(0,n.jsx)(t.code,{children:"Enable new engine +"})," -> ",(0,n.jsx)(t.code,{children:"KV"})," -> Path: ",(0,n.jsx)(t.code,{children:"common"})]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Createa ",(0,n.jsx)(t.code,{children:"ClusterSecretStore"})," for Vault"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'apiVersion: external-secrets.io/v1beta1\nkind: ClusterSecretStore\nmetadata:\n  name: vault\nspec:\n  provider:\n    vault:\n      server: "http://vault.vault.svc.cluster.local:8200"\n      path: "common"\n      version: "v2"\n      auth:\n        tokenSecretRef:\n          name: "vault-token"\n          namespace: vault\n          key: "token"\n'})}),"\n",(0,n.jsx)(t.h2,{id:"usecases",children:"Usecases"}),"\n",(0,n.jsxs)(t.h3,{id:"white_check_mark-basic-get-secret-add-secret-from-secret-store",children:["\u2705"," Basic: get secret, add secret from secret store"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["example ",(0,n.jsx)(t.code,{children:"ExternalSecret"})," to read secret from secret store"]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'apiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: test\n  namespace: default\nspec:\n  refreshInterval: 10m\n  secretStoreRef:\n    name: vault\n    kind: ClusterSecretStore\n  target:\n    name: test\n    creationPolicy: Owner\n  dataFrom:\n  - extract:\n      key: "/test"\n'})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["example ",(0,n.jsx)(t.code,{children:"PushSecret"})," from k8s to secret store"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Usecase: some resource created in k8s store its secret in k8s-secret,\nand we use PushSecret to save it in Vault and be accessible outside of k8s"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://external-secrets.io/latest/guides/pushsecrets/",children:"Source"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"cat <<EOF | kubectl apply -f -\n---\napiVersion: external-secrets.io/v1alpha1\nkind: PushSecret\nmetadata:\n  name: argocd-secret # Customisable\n  namespace: argocd # Same of the SecretStores\nspec:\n  updatePolicy: Replace # Policy to overwrite existing secrets in the provider on sync\n  deletionPolicy: Delete # the provider' secret will be deleted if the PushSecret is deleted\n  refreshInterval: 10m # Refresh interval for which push secret will reconcile\n  secretStoreRefs: # A list of secret stores to push secrets to\n    - name: vault\n      kind: ClusterSecretStore\n  selector:\n    secret:\n      name: argocd-secret # Source Kubernetes secret to be pushed\n  data:\n    - conversionStrategy: None # Also supports the ReverseUnicode strategy\n      match:\n        # secretKey: best-pokemon # Source Kubernetes secret key to be pushed (comment out to push all keys)\n        remoteRef:\n          remoteKey: argocd/admin # Remote reference (where the secret is going to be pushed)\nEOF\n"})}),"\n",(0,n.jsx)(t.h3,{id:"common-generate-secrets-update-secrets-rotate-secrets",children:"Common: generate secrets, update secrets, rotate secrets"}),"\n",(0,n.jsxs)(t.h2,{id:"white_check_mark-monitoring",children:["\u2705"," Monitoring"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://external-secrets.io/v0.19.0/api/metrics/",children:"Docs"})}),"\n",(0,n.jsx)(t.admonition,{title:"Grafana Dashboard",type:"note",children:(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://raw.githubusercontent.com/external-secrets/external-secrets/main/docs/snippets/dashboard.json",children:"https://raw.githubusercontent.com/external-secrets/external-secrets/main/docs/snippets/dashboard.json"})})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"\nexternal-secrets:\n  serviceMonitor:\n    enabled: true\n"})}),"\n",(0,n.jsx)(t.h2,{id:"maintenence",children:"Maintenence"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Backup / Restore"}),"\n",(0,n.jsx)(t.li,{children:"Scaling"}),"\n",(0,n.jsx)(t.li,{children:"Upgrade"}),"\n"]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"articles",children:"Articles"})]})}function h(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>i});var r=s(6540);const n={},c=r.createContext(n);function a(e){const t=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(c.Provider,{value:t},e.children)}}}]);