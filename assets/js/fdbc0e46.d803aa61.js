"use strict";(self.webpackChunkdevops_sandbox=self.webpackChunkdevops_sandbox||[]).push([[3059],{5991:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"observability/metrics/prometheus","title":"Prometheus","description":"|Distro|Prometheus|","source":"@site/docs/observability/metrics/prometheus.md","sourceDirName":"observability/metrics","slug":"/observability/metrics/prometheus","permalink":"/docs/observability/metrics/prometheus","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"tool","permalink":"/docs/tags/tool"},{"inline":true,"label":"distro","permalink":"/docs/tags/distro"},{"inline":true,"label":"prometheus","permalink":"/docs/tags/prometheus"},{"inline":true,"label":"metrics","permalink":"/docs/tags/metrics"},{"inline":true,"label":"observability","permalink":"/docs/tags/observability"}],"version":"current","frontMatter":{"tags":["tool","distro","prometheus","metrics","observability"]},"sidebar":"tutorialSidebar","previous":{"title":"Grafana","permalink":"/docs/observability/metrics/grafana"},"next":{"title":"\ud83d\udd0d Tracing","permalink":"/docs/observability/tracing/"}}');var r=n(4848),o=n(8453);const l={tags:["tool","distro","prometheus","metrics","observability"]},i="Prometheus",c={},a=[{value:"Setup",id:"setup",level:2},{value:"Usecases",id:"usecases",level:2},{value:"\u2705 Basic: kube-state-metrics, node-exporter",id:"white_check_mark-basic-kube-state-metrics-node-exporter",level:3},{value:"Common:",id:"common",level:3},{value:"\u2705 Monitoring",id:"white_check_mark-monitoring",level:2},{value:"Maintenence",id:"maintenence",level:2},{value:"Articles",id:"articles",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"prometheus",children:"Prometheus"})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Distro"})}),(0,r.jsx)(s.th,{children:(0,r.jsx)(s.a,{href:"https://prometheus.io",children:"Prometheus"})})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Type"})}),(0,r.jsx)(s.td,{children:"kubernetes-operator"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Deploy"})}),(0,r.jsx)(s.td,{children:"helm-chart"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Docs"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.a,{href:"https://prometheus.io/docs/introduction/overview/",children:"link"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Backup"})}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Scaling"})}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"CLI"})}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"UI"})}),(0,r.jsx)(s.td,{children:"web"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(s.p,{children:"This allows Prometheus to monitor resources created outside of the kube-prometheus-stack installation."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"kube-prometheus-stack:\n  prometheus:\n    prometheusSpec:\n      ruleSelectorNilUsesHelmValues: false\n      serviceMonitorSelectorNilUsesHelmValues: false\n      podMonitorSelectorNilUsesHelmValues: false\n      probeSelectorNilUsesHelmValues: false\n"})}),"\n",(0,r.jsx)(s.h2,{id:"usecases",children:"Usecases"}),"\n",(0,r.jsxs)(s.h3,{id:"white_check_mark-basic-kube-state-metrics-node-exporter",children:["\u2705"," Basic: kube-state-metrics, node-exporter"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"kube-state-metrics"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'  kube-state-metrics:\n    fullnameOverride: "kube-state-metrics"\n    releaseLabel: true\n    prometheus:\n      monitor:\n        enabled: true\n        honorLabels: true\n        metricRelabelings:\n          - action: drop\n            regex: kube_pod_tolerations\n            sourceLabels:\n              - __name__\n          - action: drop\n            regex: kubernetes_feature_enabled\n            sourceLabels:\n              - __name__\n          - action: drop\n            regex: kube_pod_status_reason\n            sourceLabels:\n              - __name__\n          - action: labeldrop\n            regex: uid\n          - action: drop\n            regex: kube_pod_status_qos_class\n            sourceLabels:\n              - __name__\n          - action: drop\n            regex: kube_pod_status_ready\n            sourceLabels:\n              - __name__\n          - action: drop\n            regex: kube_pod_status_scheduled\n            sourceLabels:\n              - __name__\n\n    metricLabelsAllowlist:\n      - pods=[*]\n      - cronjobs=[*]\n      - jobs=[*]\n      - deployments=[*]\n      - statefulsets=[*]\n      - nodes=[*]\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"node-exporter"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"  prometheus-node-exporter:\n    extraArgs:\n      - --collector.filesystem.mount-points-exclude=^/(dev|proc|sys|var/lib/docker/.+|var/lib/kubelet/.+)($|/)\n      - --collector.filesystem.fs-types-exclude=^(autofs|binfmt_misc|bpf|cgroup2?|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|iso9660|mqueue|nsfs|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|selinuxfs|squashfs|sysfs|tracefs)$\n      - --no-collector.arp\n      - --no-collector.bcache\n      - --no-collector.bonding\n      - --no-collector.btrfs\n      - --no-collector.dmi\n      - --no-collector.fibrechannel\n      - --no-collector.hwmon\n      - --no-collector.infiniband\n      - --no-collector.ipvs\n      - --no-collector.nfs\n      - --no-collector.rapl\n      - --no-collector.sockstat\n      - --no-collector.softnet\n      - --no-collector.tapestats\n      - --no-collector.textfile\n      - --no-collector.thermal_zone\n      - --no-collector.xfs\n      - --no-collector.zfs\n"})}),"\n",(0,r.jsx)(s.h3,{id:"common",children:"Common:"}),"\n",(0,r.jsxs)(s.h2,{id:"white_check_mark-monitoring",children:["\u2705"," Monitoring"]}),"\n",(0,r.jsxs)(s.p,{children:["Self-created grafana dashboard can be found in the ",(0,r.jsx)(s.a,{href:"https://github.com/andrewozh/devops-sandbox/blob/main/apps-common/kube-prometheus-stack/dashboards/prometheus.json",children:"kube-prometheus-stack/dashboards"})]}),"\n",(0,r.jsx)(s.h2,{id:"maintenence",children:"Maintenence"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Backup / Restore"}),"\n",(0,r.jsx)(s.li,{children:"Scaling"}),"\n",(0,r.jsx)(s.li,{children:"Upgrade"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"articles",children:"Articles"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"/docs/observability/metrics/articles/prometheus-stack-architecture#prometheus-server",children:"Prometheus Stack Architecture"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>i});var t=n(6540);const r={},o=t.createContext(r);function l(e){const s=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);