"use strict";(self.webpackChunkdevops_sandbox=self.webpackChunkdevops_sandbox||[]).push([[4752],{5192:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>i});const t=JSON.parse('{"id":"observability/metrics/grafana-dashboard-patcher","title":"Grafana Dashboard patcher","description":"TODO","source":"@site/docs/observability/metrics/grafana-dashboard-patcher.md","sourceDirName":"observability/metrics","slug":"/observability/metrics/grafana-dashboard-patcher","permalink":"/docs/observability/metrics/grafana-dashboard-patcher","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"DataDog","permalink":"/docs/observability/metrics/datadog"},"next":{"title":"Grafana","permalink":"/docs/observability/metrics/grafana"}}');var r=n(4848),s=n(8453);const l={},c="Grafana Dashboard patcher",o={},i=[{value:"TODO",id:"todo",level:2},{value:"Tool",id:"tool",level:2}];function d(e){const a={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.header,{children:(0,r.jsx)(a.h1,{id:"grafana-dashboard-patcher",children:"Grafana Dashboard patcher"})}),"\n",(0,r.jsx)(a.h2,{id:"todo",children:"TODO"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["fix: only forst metric in ",(0,r.jsx)(a.code,{children:"expr"})," is patched"]}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"tool",children:"Tool"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"add specific variables"}),"\n",(0,r.jsx)(a.li,{children:"patch all metrics in expr to use variables"}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:'INPUT_FILE="$1"\njq \'.templating.list += [\n    {\n      "name": "datacenter",\n      "query": "label_values(kube_deployment_labels,datacenter)",\n      "label": "Datacenter",\n      "type": "query",\n      "datasource": null,\n      "refresh": 1,\n      "includeAll": false,\n      "multi": false\n    },\n    {\n      "name": "cluster",\n      "query": "label_values(kube_deployment_labels{datacenter=\\"$datacenter\\"},clusterID)",\n      "label": "Cluster",\n      "type": "query",\n      "datasource": null,\n      "refresh": 1,\n      "includeAll": false,\n      "multi": false\n    }\n  ] | (.. | objects | select(has("expr")) | .expr) |= sub("\\\\{"; "{datacenter=\\"$datacenter\\",clusterID=\\"$cluster\\",")\n\' "$INPUT_FILE" >"$INPUT_FILE.tmp" && mv "$INPUT_FILE.tmp" "$INPUT_FILE"\n'})})]})}function u(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>l,x:()=>c});var t=n(6540);const r={},s=t.createContext(r);function l(e){const a=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:a},e.children)}}}]);