"use strict";(self.webpackChunkdevops_sandbox=self.webpackChunkdevops_sandbox||[]).push([[9242],{5637:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"db/postgresql/cloudnative-pg","title":"CloudNativePG","description":"|Tool|CloudNativePG|","source":"@site/docs/db/postgresql/cloudnative-pg.md","sourceDirName":"db/postgresql","slug":"/db/postgresql/cloudnative-pg","permalink":"/docs/db/postgresql/cloudnative-pg","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"distro","permalink":"/docs/tags/distro"},{"inline":true,"label":"cloudnative-pg","permalink":"/docs/tags/cloudnative-pg"},{"inline":true,"label":"postgres","permalink":"/docs/tags/postgres"},{"inline":true,"label":"database","permalink":"/docs/tags/database"}],"version":"current","frontMatter":{"tags":["distro","cloudnative-pg","postgres","database"]},"sidebar":"tutorialSidebar","previous":{"title":"PostgreSQL","permalink":"/docs/db/postgresql/"},"next":{"title":"Redis","permalink":"/docs/db/redis/"}}');var s=t(4848),r=t(8453);const i={tags:["distro","cloudnative-pg","postgres","database"]},l="CloudNativePG",o={},c=[{value:"\u2705 Setup",id:"white_check_mark-setup",level:2},{value:"Usecases",id:"usecases",level:2},{value:"\u2705 Basic: create db, create role, connect, etc.",id:"white_check_mark-basic-create-db-create-role-connect-etc",level:3},{value:"Common: write data, read data, replication, etc.",id:"common-write-data-read-data-replication-etc",level:3},{value:"Advanced: external-secrets integrations (automation of password management)",id:"advanced-external-secrets-integrations-automation-of-password-management",level:3},{value:"\u2705 Monitoring",id:"white_check_mark-monitoring",level:2},{value:"Maintenence",id:"maintenence",level:2},{value:"Patform integration",id:"patform-integration",level:2},{value:"Articles",id:"articles",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"cloudnativepg",children:"CloudNativePG"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Tool"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.a,{href:"https://cloudnative-pg.io",children:"CloudNativePG"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Type"})}),(0,s.jsx)(n.td,{children:"kubernetes-operator"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Deploy"})}),(0,s.jsx)(n.td,{children:"helm-chart"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Backup"})}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Scaling"})}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"CLI"})}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"UI"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://www.pgadmin.org",children:"pgadmin"})})]})]})]}),"\n",(0,s.jsxs)(n.h2,{id:"white_check_mark-setup",children:["\u2705"," Setup"]}),"\n",(0,s.jsx)(n.admonition,{title:"Original cluster helm-chart",type:"note",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/cloudnative-pg/charts/tree/main/charts/cluster",children:"https://github.com/cloudnative-pg/charts/tree/main/charts/cluster"})})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# https://github.com/cloudnative-pg/charts/blob/main/charts/cluster/examples/basic.yaml\n# https://cloudnative-pg.io/documentation/1.26/samples/cluster-example-with-roles.yaml\ncluster:\n  type: postgresql\n  mode: standalone\n  version:\n    postgresql: "16"\n  cluster:\n    instances: 1\n    storage:\n      size: 2Gi\n  backups:\n    enabled: false\n'})}),"\n",(0,s.jsx)(n.h2,{id:"usecases",children:"Usecases"}),"\n",(0,s.jsxs)(n.h3,{id:"white_check_mark-basic-create-db-create-role-connect-etc",children:["\u2705"," Basic: create db, create role, connect, etc."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Connect"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# creds in secret `postgres-cluster-superuser`\nexport PGPASSWORD=$(kubectl get secret postgres-cluster-superuser -n postgres -o jsonpath='{.data.password}' | base64 -d)\n# do port-forward service `postgres-cluster-rw` to localhost\nkubectl port-forward svc/postgres-cluster-rw -n portgres 5432:5432\n# connect\npsql -h localhost -p 5432 -U postgres -d postgres\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create Roles"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://cloudnative-pg.io/documentation/1.26/declarative_role_management/",children:"https://cloudnative-pg.io/documentation/1.26/declarative_role_management/"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'cat <<EOF | kubectl apply -f -\napiVersion: v1\ndata:\n  username: $(echo -n "dante" | base64)\n  password: $(echo -n "dante" | base64)\nkind: Secret\nmetadata:\n  name: psql-role-dante\n  namespace: postgres\n  labels:\n    cnpg.io/reload: "true"\ntype: kubernetes.io/basic-auth\nEOF\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'cluster:\n  managed:\n    roles:\n    - name: app\n      createdb: true\n      login: true\n    - name: dante\n      ensure: present\n      comment: my database-side comment\n      login: true\n      superuser: false\n      createdb: true\n      createrole: false\n      inherit: false\n      replication: false\n      bypassrls: false\n      connectionLimit: 4\n      validUntil: "2053-04-12T15:04:05Z"\n      inRoles:\n        - pg_monitor\n        - pg_signal_backend\n      passwordSecret:\n        name: psql-role-dante\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create Database"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://cloudnative-pg.io/documentation/1.26/declarative_database_management/#postgresql-database-management",children:"https://cloudnative-pg.io/documentation/1.26/declarative_database_management/#postgresql-database-management"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | kubectl apply -f -\napiVersion: postgresql.cnpg.io/v1\nkind: Database\nmetadata:\n  name: psql-db-postgres-cluster-dante\n  namespace: postgres\nspec:\n  databaseReclaimPolicy: delete\n  name: dante\n  owner: postgres\n  cluster:\n    name: postgres-cluster\n  schemas:\n  - name: public\n    owner: dante\n  extensions:\n  - name: bloom\n    ensure: present\nEOF\n"})}),"\n",(0,s.jsx)(n.h3,{id:"common-write-data-read-data-replication-etc",children:"Common: write data, read data, replication, etc."}),"\n",(0,s.jsx)(n.h3,{id:"advanced-external-secrets-integrations-automation-of-password-management",children:"Advanced: external-secrets integrations (automation of password management)"}),"\n",(0,s.jsxs)(n.h2,{id:"white_check_mark-monitoring",children:["\u2705"," Monitoring"]}),"\n",(0,s.jsx)(n.admonition,{title:"Grafana Dashboard (operator + cluster)",type:"note",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/20417-cloudnativepg/",children:"https://grafana.com/grafana/dashboards/20417-cloudnativepg/"}),"\n",(0,s.jsx)(n.a,{href:"https://github.com/cloudnative-pg/grafana-dashboards",children:"https://github.com/cloudnative-pg/grafana-dashboards"})]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"cloudnative-pg:\n  monitoring:\n    podMonitorEnabled: true\ncluster:\n  cluster:\n    monitoring:\n      enabled: true\n"})}),"\n",(0,s.jsx)(n.h2,{id:"maintenence",children:"Maintenence"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Backup / Restore"}),"\n",(0,s.jsx)(n.li,{children:"Scaling"}),"\n",(0,s.jsx)(n.li,{children:"Upgrade"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"patform-integration",children:"Patform integration"}),"\n",(0,s.jsx)(n.p,{children:"how this tool integrated into a platform\nhow to use it in a platform\nhow to debug"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"articles",children:"Articles"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var a=t(6540);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);