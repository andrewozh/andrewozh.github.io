"use strict";(self.webpackChunkdevops_sandbox=self.webpackChunkdevops_sandbox||[]).push([[8041],{2978:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"networking/tls/cert-manager","title":"cert-manager","description":"||Self-hosted|SaaS|","source":"@site/docs/networking/tls/cert-manager.md","sourceDirName":"networking/tls","slug":"/networking/tls/cert-manager","permalink":"/docs/networking/tls/cert-manager","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"distro","permalink":"/docs/tags/distro"},{"inline":true,"label":"cert-manager","permalink":"/docs/tags/cert-manager"},{"inline":true,"label":"tls","permalink":"/docs/tags/tls"},{"inline":true,"label":"networking","permalink":"/docs/tags/networking"}],"version":"current","frontMatter":{"tags":["distro","cert-manager","tls","networking"]},"sidebar":"tutorialSidebar","previous":{"title":"kong","permalink":"/docs/networking/ingress/kong"},"next":{"title":"istio","permalink":"/docs/networking/service-mesh/istio"}}');var s=t(4848),i=t(8453);const a={tags:["distro","cert-manager","tls","networking"]},c="cert-manager",l={},o=[{value:"\u2705 Architectire",id:"white_check_mark-architectire",level:2},{value:"Usecases",id:"usecases",level:2},{value:"\u2705 Basic: TLS for local ingress-nginx (self-signed CA)",id:"white_check_mark-basic-tls-for-local-ingress-nginx-self-signed-ca",level:3},{value:"Common: TLS for exposed ingress-nginx (Let&#39;s Encrypt)",id:"common-tls-for-exposed-ingress-nginx-lets-encrypt",level:3},{value:"Advanced: secure Istio service mesh",id:"advanced-secure-istio-service-mesh",level:3},{value:"\u2705 Monitoring",id:"white_check_mark-monitoring",level:2},{value:"Maintenence",id:"maintenence",level:2},{value:"Patform integration",id:"patform-integration",level:2},{value:"Articles",id:"articles",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"cert-manager",children:"cert-manager"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{}),(0,s.jsx)(n.th,{children:"Self-hosted"}),(0,s.jsx)(n.th,{children:"SaaS"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Name"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://cert-manager.io",children:"cert-manager"})}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Type"})}),(0,s.jsx)(n.td,{children:"kubernetes-operator"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Deploy"})}),(0,s.jsx)(n.td,{children:"helm-chart"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Backup"})}),(0,s.jsx)(n.td,{children:"manual"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Scaling"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"CLI"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://cert-manager.io/docs/reference/cmctl/",children:"cmctl"})}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"UI"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsxs)(n.h2,{id:"white_check_mark-architectire",children:["\u2705"," Architectire"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"creates TLS certificates for workloads in your Kubernetes or OpenShift cluster and renews the certificates before they expire."}),"\n",(0,s.jsx)(n.li,{children:"can obtain certificates from a variety of certificate authorities, including: Let's Encrypt, HashiCorp Vault, Venafi and private PKI."}),"\n",(0,s.jsx)(n.li,{children:"private key and certificate are stored in a Kubernetes Secret which is mounted by an application Pod or used by an Ingress controller"}),"\n",(0,s.jsx)(n.li,{children:"With csi-driver, csi-driver-spiffe, or istio-csr , the private key is generated on-demand, before the application starts up; the private key never leaves the node and it is not stored in a Kubernetes Secret."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"cert manager workflow",src:t(5779).A+"",width:"700",height:"697"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The Ingress object will be created with the reference of the Cert Manager Issuers."}),"\n",(0,s.jsx)(n.li,{children:"The Ingress Controller will get the information from the Ingress object and request a certificate from the Cert Manager."}),"\n",(0,s.jsx)(n.li,{children:"The Cert Manager will request the Certificate Authority, for example, Let's Encrypt."}),"\n",(0,s.jsx)(n.li,{children:"After the verification, the CA will generate and provide the certificate to the Cert Manager."}),"\n",(0,s.jsx)(n.li,{children:"The generated certificate will be stored in Kubernetes as a TLS Secret."}),"\n",(0,s.jsx)(n.li,{children:"The Ingress Controller will encrypt the traffic using the stored certificate for the TLS termination."}),"\n",(0,s.jsx)(n.li,{children:"When a user tries to access the application, the external traffic is routed from the external Load Balancer to the Ingress Controller."}),"\n",(0,s.jsx)(n.li,{children:"The TLS termination will happen in the Ingress Controller with the TLS certificate and securely route the traffic to the application Pods."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usecases",children:"Usecases"}),"\n",(0,s.jsxs)(n.h3,{id:"white_check_mark-basic-tls-for-local-ingress-nginx-self-signed-ca",children:["\u2705"," Basic: TLS for local ingress-nginx (self-signed CA)"]}),"\n",(0,s.jsx)(n.p,{children:"self-signe CA cert for local use"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"openssl genrsa -out ca.key 4096\nopenssl req -new -x509 -sha256 -days 365 -key ca.key -out ca.crt\nsudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ca.crt\nkubectl create secret generic -n vault ca --from-file=tls.crt=ca.crt --from-file=tls.key=ca.key\n"})}),"\n",(0,s.jsxs)(n.p,{children:["create a ",(0,s.jsx)(n.code,{children:"ClusterIssuer"})," for self-signed CA"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: cluster-issuer-nginx\nspec:\n  ca:\n    secretName: ca\n"})}),"\n",(0,s.jsxs)(n.p,{children:["create a ",(0,s.jsx)(n.code,{children:"Certificate"})," for ",(0,s.jsx)(n.code,{children:"ingress-nginx"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: demo-cert\nspec:\n  secretName: demo-tls-secret\n  issuerRef:\n    name: cluster-issuer-nginx\n    kind: ClusterIssuer\n  dnsNames:\n    - demo.home.lab\n"})}),"\n",(0,s.jsxs)(n.p,{children:["use secret created by ",(0,s.jsx)(n.code,{children:"Certificate"})," in ",(0,s.jsx)(n.code,{children:"Ingress"})," resource definition:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: demo\nspec:\n  # . . .\n  tls:\n  - hosts:\n    - demo.home.lab\n    secretName: demo-tls-secret\n"})}),"\n",(0,s.jsx)(n.h3,{id:"common-tls-for-exposed-ingress-nginx-lets-encrypt",children:"Common: TLS for exposed ingress-nginx (Let's Encrypt)"}),"\n",(0,s.jsx)(n.admonition,{title:"Let's Encrypt Example",type:"tip",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.f5.com/company/blog/nginx/automating-certificate-management-in-a-kubernetes-environment",children:"https://www.f5.com/company/blog/nginx/automating-certificate-management-in-a-kubernetes-environment"})})}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","letsencrypt"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","cloudflare"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","aws/gcp/azure"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","vault-pki"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"advanced-secure-istio-service-mesh",children:"Advanced: secure Istio service mesh"}),"\n",(0,s.jsxs)(n.h2,{id:"white_check_mark-monitoring",children:["\u2705"," Monitoring"]}),"\n",(0,s.jsx)(n.admonition,{title:"Official docs",type:"note",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://cert-manager.io/docs/devops-tips/prometheus-metrics/",children:"https://cert-manager.io/docs/devops-tips/prometheus-metrics/"})})}),"\n",(0,s.jsx)(n.admonition,{title:"Grafana Dashboard",type:"note",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/20340-cert-manager/",children:"https://grafana.com/grafana/dashboards/20340-cert-manager/"})})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["enable metrics and ",(0,s.jsx)(n.code,{children:"PodMonitor"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"cert-manager:\n  prometheus:\n    enabled: true\n    podmonitor:\n      enabled: true\n"})}),"\n",(0,s.jsx)(n.h2,{id:"maintenence",children:"Maintenence"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Install / Deploy"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Backup / Restore"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://cert-manager.io/v1.1-docs/tutorials/backup/",children:"https://cert-manager.io/v1.1-docs/tutorials/backup/"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Scaling"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Upgrade"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"patform-integration",children:"Patform integration"}),"\n",(0,s.jsx)(n.p,{children:"how this tool integrated into a platform\nhow to use it in a platform\nhow to debug"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"articles",children:"Articles"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#",children:"Example article link"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},5779:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/cert-manager-workflow-6bfd2ec29839c24af132c3d2a81da553.gif"},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var r=t(6540);const s={},i=r.createContext(s);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);