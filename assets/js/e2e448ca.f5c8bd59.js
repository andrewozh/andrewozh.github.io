"use strict";(self.webpackChunkdevops_sandbox=self.webpackChunkdevops_sandbox||[]).push([[2089],{4011:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"db/redis/redis-operator","title":"Redis Operator by OpsTree","description":"|Distro|Redis Operator by OpsTree|","source":"@site/docs/db/redis/redis-operator.md","sourceDirName":"db/redis","slug":"/db/redis/redis-operator","permalink":"/docs/db/redis/redis-operator","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"distro","permalink":"/docs/tags/distro"},{"inline":true,"label":"redis-operator","permalink":"/docs/tags/redis-operator"},{"inline":true,"label":"redis","permalink":"/docs/tags/redis"},{"inline":true,"label":"database","permalink":"/docs/tags/database"}],"version":"current","frontMatter":{"tags":["distro","redis-operator","redis","database"]},"sidebar":"tutorialSidebar","previous":{"title":"Redis ACL Rules","permalink":"/docs/db/redis/articles/redis-acl-rules"},"next":{"title":"\ud83d\udd27 Tools","permalink":"/docs/category/-tools"}}');var i=s(4848),d=s(8453);const t={tags:["distro","redis-operator","redis","database"]},a="Redis Operator by OpsTree",l={},o=[{value:"\u2705 Setup",id:"white_check_mark-setup",level:2},{value:"Usecases",id:"usecases",level:2},{value:"\u2705 Basic: create writter/reader users",id:"white_check_mark-basic-create-writterreader-users",level:3},{value:"Common:",id:"common",level:3},{value:"\u2705 Monitoring",id:"white_check_mark-monitoring",level:2},{value:"Maintenence",id:"maintenence",level:2},{value:"Articles",id:"articles",level:2}];function c(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"redis-operator-by-opstree",children:"Redis Operator by OpsTree"})}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:(0,i.jsx)(r.strong,{children:"Distro"})}),(0,i.jsx)(r.th,{children:(0,i.jsx)(r.a,{href:"https://github.com/ot-container-kit/redis-operator",children:"Redis Operator by OpsTree"})})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Type"})}),(0,i.jsx)(r.td,{children:"kubernetes-operator"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Deploy"})}),(0,i.jsx)(r.td,{children:"helm-chart"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Docs"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"https://redis-operator.opstree.dev/docs/",children:"link"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Backup"})}),(0,i.jsx)(r.td,{})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Scaling"})}),(0,i.jsx)(r.td,{})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"CLI"})}),(0,i.jsx)(r.td,{})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"UI"})}),(0,i.jsx)(r.td,{children:"web"})]})]})]}),"\n",(0,i.jsxs)(r.h2,{id:"white_check_mark-setup",children:["\u2705"," Setup"]}),"\n",(0,i.jsx)(r.admonition,{title:"Redis configuration",type:"warning",children:(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Redis Cluster"})," = Minimum 3 masters (for sharding data)"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Redis Replication"})," = 1 master + N replicas (for HA without sharding)"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Redis Standalone"})," = Single instance (simplest setup)"]}),"\n"]})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"create admin password secret"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"kubectl create secret generic redis-secret --from-literal=password=redis -n redis\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"redis-cluster setup"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'redis-cluster:\n  rediscluster:\n    clustersize: 3\n    leader:\n      replicas: 3\n    follower:\n      replicas: 3\n    redisSecret:\n      secretName: "redis-secret"\n      secretKey: "password"\n'})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"connect"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"kubectl exec -it redis-operator-leader-0 -n redis -- redis-cli -a redis\n"})}),"\n",(0,i.jsx)(r.h2,{id:"usecases",children:"Usecases"}),"\n",(0,i.jsxs)(r.h3,{id:"white_check_mark-basic-create-writterreader-users",children:["\u2705"," Basic: create writter/reader users"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"users.acl"})," secret"]}),"\n"]}),"\n",(0,i.jsx)(r.admonition,{type:"tip",children:(0,i.jsx)(r.p,{children:(0,i.jsx)(r.a,{href:"/docs/db/redis/articles/redis-acl-rules",children:"Redis ACL Guide"})})}),"\n",(0,i.jsx)(r.admonition,{type:"warning",children:(0,i.jsxs)(r.p,{children:["In ",(0,i.jsx)(r.code,{children:"ACL"})," mode default user must be configured with ",(0,i.jsx)(r.code,{children:"on"})," and ",(0,i.jsx)(r.code,{children:">password"})," to allow access or disabled.\nThis will replace the ",(0,i.jsx)(r.code,{children:"rediscluster.redisSecret"})," configuration"]})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: redis-users-acl\nstringData:\n  users.acl: |\n    user default on ~* &* +@all >redis\n    user admin on ~* &* +@all >admin\n    user reader on +@read ~* &* -@dangerous >reader\n    user writer on +@write +@read ~app:* -@dangerous >writer\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["configure ",(0,i.jsx)(r.code,{children:"RedisCluster"})]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'redis-cluster:\n  acl:\n    secret:\n      secretName: "redis-users-acl"\n'})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"verify and connect"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:'$  kubectl exec -it redis-operator-leader-0 -n redis -- redis-cli -a redis\nDefaulted container "redis-operator-leader" out of: redis-operator-leader, redis-exporter\nWarning: Using a password with \'-a\' or \'-u\' option on the command line interface may not be safe.\n127.0.0.1:6379> acl list\n1) "user admin on #8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 ~* &* +@all"\n2) "user default on #34fb46c847bb9df96e5205a39d382f648a6e8dce1e014cd85b4ca6a88d88ed03 ~* &* +@all"\n3) "user reader on #3d0941964aa3ebdcb00ccef58b1bb399f9f898465e9886d5aec7f31090a0fb30 ~* &* -@all +@read -sort_ro -keys"\n4) "user writer on #b93006774cbdd4b299389a03ac3d88c3a76b460d538795bc12718011a909fba5 ~app:* resetchannels -@all +@string +@hash +@geo +@blocking +@bitmap +@set +@hyperloglog +@stream +@sortedset +@list +@keyspace -sort +function|restore +function|flush +function|load +function|delete -sort_ro -object|help -restore-asking -keys +lolwut -flushall -swapdb -pfdebug -xgroup|help -migrate -restore -flushdb -xinfo|help -pfselftest +memory|usage"\n127.0.0.1:6379>\n\n$  kubectl exec -it redis-operator-leader-0 -n redis -- redis-cli --user reader --pass reader\nDefaulted container "redis-operator-leader" out of: redis-operator-leader, redis-exporter\nWarning: Using a password with \'-a\' or \'-u\' option on the command line interface may not be safe.\n127.0.0.1:6379>\n'})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"write/read key"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"$  kubectl exec -it redis-operator-leader-0 -n redis -- redis-cli --user writer --pass writer\nDefaulted container \"redis-operator-leader\" out of: redis-operator-leader, redis-exporter\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n127.0.0.1:6379> keys *\n(error) NOPERM this user has no permissions to run the 'keys' command\n127.0.0.1:6379> set hello \"world\"\n(error) NOPERM this user has no permissions to access one of the keys used as arguments\n127.0.0.1:6379> set app:hello \"world\"\nOK\n127.0.0.1:6379> exit\n\n$  kubectl exec -it redis-operator-leader-0 -n redis -- redis-cli --user reader --pass reader\nDefaulted container \"redis-operator-leader\" out of: redis-operator-leader, redis-exporter\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n127.0.0.1:6379> get app:hello\n\"world\"\n127.0.0.1:6379> keys app:*\n(error) NOPERM this user has no permissions to run the 'keys' command\n127.0.0.1:6379> exit\n"})}),"\n",(0,i.jsx)(r.h3,{id:"common",children:"Common:"}),"\n",(0,i.jsxs)(r.h2,{id:"white_check_mark-monitoring",children:["\u2705"," Monitoring"]}),"\n",(0,i.jsx)(r.admonition,{title:"Grafana Dashboard",type:"note",children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.a,{href:"https://github.com/OT-CONTAINER-KIT/redis-operator/blob/main/dashboards/redis-operator-cluster.json",children:"https://github.com/OT-CONTAINER-KIT/redis-operator/blob/main/dashboards/redis-operator-cluster.json"}),"\n(my fixed version in kube-prometheus-stack/dashboards/)"]})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"redis-cluster:\n  serviceMonitor:\n    enabled: true\n    namespace: redis\n  redisExporter:\n    enabled: true\n"})}),"\n",(0,i.jsx)(r.h2,{id:"maintenence",children:"Maintenence"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Backup / Restore"}),"\n",(0,i.jsx)(r.li,{children:"Scaling"}),"\n",(0,i.jsx)(r.li,{children:"Upgrade"}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"articles",children:"Articles"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"#",children:"Example article link"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>t,x:()=>a});var n=s(6540);const i={},d=n.createContext(i);function t(e){const r=n.useContext(d);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),n.createElement(d.Provider,{value:r},e.children)}}}]);